doctype html
html(lang='en')
  head
    include head.pug
    link(href='/css/media-player.css', rel='stylesheet')
    link(href='/css/lyric-editor.css', rel='stylesheet')
  body
    include nav-bar.pug
    .container-fluid#root
    include footer.pug
    script(src="https://code.jquery.com/ui/1.12.1/jquery-ui.js")
    script(src='/js/ie10-viewport-bug-workaround.js')
    script(src='/js/keduije.js')
    script(src='/js/keduije-media.js')
    script(src='/song-info-form.js', type='text/babel')
    script(src='/media-controls.js', type='text/babel')
    script(src='/media-player.js', type='text/babel')
    script(src='/lyric-display.js', type='text/babel')
    if (canEdit)
      script(src='/time-spinner.js', type='text/babel')
      script(src='/lyric-editor.js', type='text/babel')
    script(type='text/babel').
      var mediaType = "#{videoID}" ? KeduIje.mediaTypes.VIDEO : KeduIje.mediaTypes.AUDIO; //Improve
      var onYouTubeIframeAPIReady;
      
      KeduIje.init("#{songID}");
      
      function setCallback(component){
        window.test=component;
        if (mediaType == KeduIje.mediaTypes.AUDIO) return;
          
        onYouTubeIframeAPIReady = component.onYouTubeIframeAPIReady;
        $.getScript( "https://www.youtube.com/iframe_api" );
      }
      ReactDOM.render(
        <MediaPlayer 
          ref={setCallback}
          canEdit={#{canEdit}}
          src={"#{src}"}
          artworkSrc={"#{artwork_src}"}
          mediaType={mediaType}
        />,
        document.getElementById('root')
      );
